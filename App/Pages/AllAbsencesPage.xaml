<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:pageModels="clr-namespace:App.PageModels"
             xmlns:viewModels="clr-namespace:App.ViewModels"
             x:Class="App.Pages.AllAbsencesPage"
             x:DataType="pageModels:AllAbsencesPageModel">

    <Grid RowDefinitions="Auto,*">
        <!-- Header with Back Button -->
        <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto" Padding="20,10" BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource Primary}}">
            <Button Grid.Column="0" 
                    Text="â† Back" 
                    Command="{Binding BackCommand}"
                    BackgroundColor="Transparent"
                    TextColor="White"
                    FontSize="16"
                    HorizontalOptions="Start"/>
            
            <Label Grid.Column="1" 
                   Text="All Absences" 
                   FontSize="18" 
                   FontAttributes="Bold"
                   TextColor="White"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"/>
        </Grid>

        <Grid Grid.Row="1" RowDefinitions="Auto,*">
            <!-- Summary Stats -->
            <Border Grid.Row="0" 
                    Stroke="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}"
                    StrokeThickness="1"
                    BackgroundColor="{AppThemeBinding Light={StaticResource Gray50}, Dark={StaticResource Gray800}}"
                    Padding="20"
                    Margin="20,10,20,10">
                <Grid ColumnDefinitions="*,*,*,*" RowDefinitions="Auto,Auto">
                    <Label Grid.Row="0" Grid.Column="0" Text="Total" FontAttributes="Bold" HorizontalOptions="Center"/>
                    <Label Grid.Row="0" Grid.Column="1" Text="Pending" FontAttributes="Bold" HorizontalOptions="Center"/>
                    <Label Grid.Row="0" Grid.Column="2" Text="Approved" FontAttributes="Bold" HorizontalOptions="Center"/>
                    <Label Grid.Row="0" Grid.Column="3" Text="Rejected" FontAttributes="Bold" HorizontalOptions="Center"/>
                    
                    <Label Grid.Row="1" Grid.Column="0" Text="{Binding TotalAbsences}" FontSize="24" HorizontalOptions="Center" TextColor="{StaticResource Primary}"/>
                    <Label Grid.Row="1" Grid.Column="1" Text="{Binding PendingAbsences}" FontSize="24" HorizontalOptions="Center" TextColor="{StaticResource Warning}"/>
                    <Label Grid.Row="1" Grid.Column="2" Text="{Binding ApprovedAbsences}" FontSize="24" HorizontalOptions="Center" TextColor="{StaticResource Success}"/>
                    <Label Grid.Row="1" Grid.Column="3" Text="{Binding RejectedAbsences}" FontSize="24" HorizontalOptions="Center" TextColor="{StaticResource Error}"/>
                </Grid>
            </Border>

            <!-- Absences List -->
            <RefreshView Grid.Row="1" 
                         IsRefreshing="{Binding IsRefreshing}"
                         Command="{Binding RefreshCommand}">
                <CollectionView ItemsSource="{Binding AllAbsences}"
                                SelectionMode="Single"
                                SelectionChanged="OnAbsenceSelected">
                    <CollectionView.Header>
                        <Label Text="Your Absence History" 
                               FontSize="18" 
                               FontAttributes="Bold" 
                               Margin="20,10,20,10"
                               HorizontalOptions="Center"/>
                    </CollectionView.Header>
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="viewModels:AbsenceViewModel">
                            <Border Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray700}}"
                                    StrokeThickness="1"
                                    Margin="20,5"
                                    Padding="15"
                                    BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}">
                                <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto,Auto">
                                    <!-- Header with Type and Status -->
                                    <Label Grid.Row="0" Grid.Column="0" 
                                           Text="{Binding TypeText}" 
                                           FontAttributes="Bold"
                                           FontSize="16"/>
                                    <Label Grid.Row="0" Grid.Column="1" 
                                           Text="{Binding StatusText}" 
                                           TextColor="{Binding StatusColor}"
                                           FontAttributes="Bold"/>
                                    
                                    <!-- Date Range -->
                                    <Label Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                           Text="{Binding DateRange}" 
                                           FontSize="14"
                                           Margin="0,5,0,0"
                                           TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}"/>
                                    
                                    <!-- Duration -->
                                    <Label Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                                           Text="{Binding DurationText}" 
                                           FontSize="12"
                                           Margin="0,2,0,0"
                                           TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray500}}"/>
                                    
                                    <!-- Created Date -->
                                    <Label Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2"
                                           Text="{Binding CreatedText}" 
                                           FontSize="12"
                                           Margin="0,2,0,0"
                                           TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray500}}"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                    <CollectionView.EmptyView>
                        <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center" Spacing="10">
                            <Label Text="No absences found" 
                                   FontSize="18" 
                                   HorizontalOptions="Center"
                                   TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"/>
                            <Label Text="You haven't submitted any absence requests yet." 
                                   FontSize="14" 
                                   HorizontalOptions="Center"
                                   TextColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray500}}"/>
                        </VerticalStackLayout>
                    </CollectionView.EmptyView>
                </CollectionView>
            </RefreshView>
        </Grid>

        <!-- Loading Indicator -->
        <ActivityIndicator Grid.Row="1" 
                          IsRunning="{Binding IsBusy}" 
                          IsVisible="{Binding IsBusy}"
                          HorizontalOptions="Center"
                          VerticalOptions="Center"/>
    </Grid>
</ContentPage> 